---
title: "Inverse Problem of Diffusion"
author: "Martin Outzen Berild"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: pdf_document
---
```{r loadlibs, echo = F}
library(tidyverse)
```
We consider an inverse problem with a basis in the following differential equation 
$$
\frac{du(x,t)}{dt} = \frac{d^2u(x,t)}{dx^2}, \enspace u(x,0) = h_0(x), \enspace x \in (0,1), t \ge 0.
$$
Data is $u(x,t) = h_t(x)$ for a given time $t>0$. The aim of the inverse problem is $h_0(x)$.

The forward model can be written as 
$$
u(x,t) = h_t(x) = \frac{1}{\sqrt{4\pi t}}\int e^{-(x-y)^2/(4t)}h_0(y)dy, \enspace t\ge0.
$$
Using discretization we get

$$
 \bf{h}_t = \left[
  \begin{array}{c}
    h_t(x_1)\\
    h_t{x_2}\\
    \vdots \\ 
    h_t{x_N}
  \end{array}
 \right] = A \left[
 \begin{array}{c}
    h_0{x_1}\\
    h_0{x_2}\\
    \vdots\\
    h_0{x_N}
 \end{array}\right]
 = A\bf{h}_0 ,
$$
where a regular grid of N = 100 points is used, such that $x_1 = 0$, $x_2 = 0.01$, ..., $x_N = 0.99$. 
```{r createX, eval = F}
x = seq(from = 0, to = 0.99, by = 0.01)
```
The interval (0,1) is made into a circle, i.e. 1 corresponds to 0. The matrix A has elements
$$
A(i,j) = \frac{0.01}{\sqrt{4\pi t}}e^{-|x_i - x_j|^2/(4t)}.
$$
The distance $|x_i-x_j|$ is modular on the circle (0,1).

```{r createA, eval = F}
create_A <- function(x,t){
  A = diag(0.01/sqrt(4*pi*t), nrow = length(x), ncol = length(x))
  for (i in seq(1,length(x))){
    for (j in seq(i+1,length(x))){
      A[i,j] = 0.01/sqrt(4*pi*t)*exp(-(x[i]-x[j])^2/(4*t))
      A[j,i] = A[i,j]
    }
  }
  A
}
```

Measurements $\bf{y} = (y_1,...,y_N)'$ are acquired at time t = 0.001 (1ms): 
$$
y_i = h_t(x_i) + \epsilon_i, \enspace \epsilon_i \sim \mathcal{N}(0, 0.025^2), \enspace \mathrm{iid}.
$$

```{r read_data, eval = F}
y = read.delim2(file = "OppgA.txt", header = F, sep = "\n", dec = ".")[[1]]
```

```{r plotdata, eval = F}
df = data.frame(x = x, y = y)
ggplot(df, aes(x = x, y = y)) + 
  geom_point()
```
# Exercise a

# Exercise b

# Exercise c